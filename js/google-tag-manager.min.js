define(['jquery','mage/cookies'],function($){'use strict';function gtag(){dataLayer.push(arguments);}
function getItems(products,currency){var items=[];for(var i=0;i<products.length;i++){var item={};item.item_id=products[i].id;item.item_name=products[i].name;if(products[i].category){item.item_category=products[i].category;}
if(products[i].variant){item.item_variant=products[i].variant;}
item.price=products[i].price;item.quantity=products[i].quantity;item.currency=currency;items[i]=item;}
return items;}
return function(config){var allowServices=false,allowedCookies,allowedWebsites,f,j,dl;(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});f=d.getElementsByTagName(s)[0];j=d.createElement(s);dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer',config.gtmAccountId);window.dlCurrencyCode=config.storeCurrencyCode;if(config.ordersData.length>0){$.each(config.ordersData,function(index,value){if(!value.ecommerce||!value.ecommerce.purchase||!value.event){dataLayer.push(value);return;}
var purchase=value.ecommerce.purchase;dataLayer.push({'event':value.event,'ecommerce':{'currencyCode':config.storeCurrencyCode,'transaction_id':purchase.actionField.id,'value':purchase.actionField.revenue,'shipping':purchase.actionField.shipping,'tax':purchase.actionField.tax,'coupon':purchase.actionField.coupon,'currency':value.ecommerce.currencyCode,'items':getItems(purchase.products,value.ecommerce.currencyCode)}});dataLayer.push(value);});}
$(document).trigger('ga:inited');}});